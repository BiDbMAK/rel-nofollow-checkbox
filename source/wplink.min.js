!function(a,b,c){function n(){return d?d.$('a[data-wplink-edit="true"]'):null}var d,e,f,g,h,i=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,63}$/i,j=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,63}[^ "]*$/i,k={},l={},m="ontouchend"in document;window.wpLink={timeToTriggerRiver:150,minRiverAJAXDuration:200,riverBottomThreshold:5,keySensitivity:100,lastSearch:"",textarea:"",modalOpen:!1,init:function(){var b='<div><label><span> </span><input type="checkbox" id="rel-nofollow-checkbox" /><strong> rel="nofollow"</strong></label></div>';a(b).insertAfter("#wp-link .link-target"),k.wrap=a("#wp-link-wrap"),k.dialog=a("#wp-link"),k.backdrop=a("#wp-link-backdrop"),k.submit=a("#wp-link-submit"),k.close=a("#wp-link-close"),k.text=a("#wp-link-text"),k.url=a("#wp-link-url"),k.nonce=a("#_ajax_linking_nonce"),k.openInNewTab=a("#wp-link-target"),k.noFollow=a("#rel-nofollow-checkbox"),k.search=a("#wp-link-search"),l.search=new f(a("#search-results")),l.recent=new f(a("#most-recent-results")),l.elements=k.dialog.find(".query-results"),k.queryNotice=a("#query-notice-message"),k.queryNoticeTextDefault=k.queryNotice.find(".query-notice-default"),k.queryNoticeTextHint=k.queryNotice.find(".query-notice-hint"),k.dialog.keydown(wpLink.keydown),k.dialog.keyup(wpLink.keyup),k.submit.click(function(a){a.preventDefault(),wpLink.update()}),k.close.add(k.backdrop).add("#wp-link-cancel button").click(function(a){a.preventDefault(),wpLink.close()}),l.elements.on("river-select",wpLink.updateFields),k.search.on("focus.wplink",function(){k.queryNoticeTextDefault.hide(),k.queryNoticeTextHint.removeClass("screen-reader-text").show()}).on("blur.wplink",function(){k.queryNoticeTextDefault.show(),k.queryNoticeTextHint.addClass("screen-reader-text").hide()}),k.search.on("keyup input",function(){window.clearTimeout(e),e=window.setTimeout(function(){wpLink.searchInternalLinks()},500)}),k.url.on("paste",function(){setTimeout(wpLink.correctURL,0)}),k.url.on("blur",wpLink.correctURL)},correctURL:function(){var b=a.trim(k.url.val());b&&h!==b&&!/^(?:[a-z]+:|#|\?|\.|\/)/.test(b)&&(k.url.val("http://"+b),h=b)},open:function(b,c,e){var f,g=a(document.body);g.addClass("modal-open"),wpLink.modalOpen=!0,wpLink.range=null,b&&(window.wpActiveEditor=b),window.wpActiveEditor&&(this.textarea=a("#"+window.wpActiveEditor).get(0),"undefined"!==typeof window.tinymce&&(g.append(k.backdrop,k.wrap),f=window.tinymce.get(window.wpActiveEditor),d=f&&!f.isHidden()?f:null),!wpLink.isMCE()&&document.selection&&(this.textarea.focus(),this.range=document.selection.createRange()),k.wrap.show(),k.backdrop.show(),wpLink.refresh(c,e),a(document).trigger("wplink-open",k.wrap))},isMCE:function(){return d&&!d.isHidden()},refresh:function(a,b){var c="";l.search.refresh(),l.recent.refresh(),wpLink.isMCE()?wpLink.mceRefresh(a,b):(k.wrap.hasClass("has-text-field")||k.wrap.addClass("has-text-field"),document.selection?c=document.selection.createRange().text||b||"":"undefined"!==typeof this.textarea.selectionStart&&this.textarea.selectionStart!==this.textarea.selectionEnd&&(b=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)||b||""),k.text.val(b),wpLink.setDefaultValues()),m?k.url.focus().blur():window.setTimeout(function(){k.url[0].select(),k.url.focus()}),l.recent.ul.children().length||l.recent.ajax(),h=k.url.val().replace(/^http:\/\//,"")},hasSelectedText:function(a){var b,c,e,f=d.selection.getContent();if(/</.test(f)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(f)||-1===f.indexOf("href=")))return!1;if(a.length){if(c=a[0].childNodes,!c||!c.length)return!1;for(e=c.length-1;e>=0;e--)if(b=c[e],3!=b.nodeType&&!window.tinymce.dom.BookmarkManager.isBookmarkNode(b))return!1}return!0},mceRefresh:function(c,e){var f,g,h=n(),l=this.hasSelectedText(h);h.length?(f=h.text(),g=h.attr("href"),a.trim(f)||(f=e||""),c&&(j.test(c)||i.test(c))&&(g=c),"_wp_link_placeholder"!==g?(k.url.val(g),k.openInNewTab.prop("checked","_blank"===h.attr("target")),k.noFollow.prop("checked",-1!==d.dom.getAttrib(h,"class").indexOf("nofollow")),k.submit.val(b.update)):this.setDefaultValues(f),k.search.val(c&&c!==g?c:""),window.setTimeout(function(){wpLink.searchInternalLinks()})):(f=d.selection.getContent({format:"text"})||e||"",this.setDefaultValues(f)),l?(k.text.val(f),k.wrap.addClass("has-text-field")):(k.text.val(""),k.wrap.removeClass("has-text-field"))},close:function(b){a(document.body).removeClass("modal-open"),wpLink.modalOpen=!1,"noReset"!==b&&(wpLink.isMCE()?(d.plugins.wplink&&d.plugins.wplink.close(),d.focus()):(wpLink.textarea.focus(),wpLink.range&&(wpLink.range.moveToBookmark(wpLink.range.getBookmark()),wpLink.range.select()))),k.backdrop.hide(),k.wrap.hide(),h=!1,a(document).trigger("wplink-close",k.wrap)},getAttrs:function(){return wpLink.correctURL(),{href:a.trim(k.url.val()),target:k.openInNewTab.prop("checked")?"_blank":null,rel:k.noFollow.prop("checked")?"nofollow":""}},buildHtml:function(a){var b='<a href="'+a.href+'"';return a.target&&(b+=' rel="noopener" target="'+a.target+'"'),a.rel&&(b+=' rel="'+a.rel+'"'),b+">"},update:function(){wpLink.isMCE()?wpLink.mceUpdate():wpLink.htmlUpdate()},htmlUpdate:function(){var d,e,f,g,h,i,j,l=wpLink.textarea;if(l){d=wpLink.getAttrs(),e=k.text.val();var m=document.createElement("a");m.href=d.href,("javascript:"===m.protocol||"data:"===m.protocol)&&(d.href=""),d.href&&(f=wpLink.buildHtml(d),document.selection&&wpLink.range?(l.focus(),wpLink.range.text=f+(e||wpLink.range.text)+"</a>",wpLink.range.moveToBookmark(wpLink.range.getBookmark()),wpLink.range.select(),wpLink.range=null):"undefined"!==typeof l.selectionStart&&(g=l.selectionStart,h=l.selectionEnd,j=e||l.value.substring(g,h),f=f+j+"</a>",i=g+f.length,g!==h||j||(i-=4),l.value=l.value.substring(0,g)+f+l.value.substring(h,l.value.length),l.selectionStart=l.selectionEnd=i),wpLink.close(),l.focus(),a(l).trigger("change"),c.a11y.speak(b.linkInserted))}},mceUpdate:function(){var f,g,h,e=wpLink.getAttrs(),i=document.createElement("a");return i.href=e.href,("javascript:"===i.protocol||"data:"===i.protocol)&&(e.href=""),e.href?(f=n(),d.undoManager.transact(function(){f.length||(d.execCommand("mceInsertLink",!1,{href:"_wp_link_placeholder","data-wp-temp-link":1}),f=d.$('a[data-wp-temp-link="1"]').removeAttr("data-wp-temp-link"),h=a.trim(f.text())),f.length?(k.wrap.hasClass("has-text-field")&&(g=k.text.val(),g?f.text(g):h||f.text(e.href)),e["data-wplink-edit"]=null,e["data-mce-href"]=e.href,f.attr(e)):d.execCommand("unlink")}),wpLink.close("noReset"),d.focus(),f.length&&(d.selection.select(f[0]),d.plugins.wplink&&d.plugins.wplink.checkLink(f[0])),d.nodeChanged(),void c.a11y.speak(b.linkInserted)):(d.execCommand("unlink"),void wpLink.close())},updateFields:function(a,b){k.url.val(b.children(".item-permalink").val()),k.wrap.hasClass("has-text-field")&&!k.text.val()&&k.text.val(b.children(".item-title").text())},getUrlFromSelection:function(b){return b||(this.isMCE()?b=d.selection.getContent({format:"text"}):document.selection&&wpLink.range?b=wpLink.range.text:"undefined"!==typeof this.textarea.selectionStart&&(b=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd))),b=a.trim(b),b&&i.test(b)?"mailto:"+b:b&&j.test(b)?b.replace(/&amp;|&#0?38;/gi,"&"):""},setDefaultValues:function(a){k.url.val(this.getUrlFromSelection(a)),k.search.val(""),wpLink.searchInternalLinks(),k.submit.val(b.save)},searchInternalLinks:function(){var a,b=k.search.val()||"";if(b.length>2){if(l.recent.hide(),l.search.show(),wpLink.lastSearch==b)return;wpLink.lastSearch=b,a=k.search.parent().find(".spinner").addClass("is-active"),l.search.change(b),l.search.ajax(function(){a.removeClass("is-active")})}else l.search.hide(),l.recent.show()},next:function(){l.search.next(),l.recent.next()},prev:function(){l.search.prev(),l.recent.prev()},keydown:function(a){var b,c;27===a.keyCode?(wpLink.close(),a.stopImmediatePropagation()):9===a.keyCode&&(c=a.target.id,"wp-link-submit"!==c||a.shiftKey?"wp-link-close"===c&&a.shiftKey&&(k.submit.focus(),a.preventDefault()):(k.close.focus(),a.preventDefault())),a.shiftKey||38!==a.keyCode&&40!==a.keyCode||(!document.activeElement||"link-title-field"!==document.activeElement.id&&"url-field"!==document.activeElement.id)&&(b=38===a.keyCode?"prev":"next",clearInterval(wpLink.keyInterval),wpLink[b](),wpLink.keyInterval=setInterval(wpLink[b],wpLink.keySensitivity),a.preventDefault())},keyup:function(a){(38===a.keyCode||40===a.keyCode)&&(clearInterval(wpLink.keyInterval),a.preventDefault())},delayedCallback:function(a,b){var c,d,e,f;return b?(setTimeout(function(){return d?a.apply(f,e):void(c=!0)},b),function(){return c?a.apply(this,arguments):(e=arguments,f=this,void(d=!0))}):a}},f=function(b,c){var d=this;this.element=b,this.ul=b.children("ul"),this.contentHeight=b.children("#link-selector-height"),this.waiting=b.find(".river-waiting"),this.change(c),this.refresh(),a("#wp-link .query-results, #wp-link #link-selector").scroll(function(){d.maybeLoad()}),b.on("click","li",function(b){d.select(a(this),b)})},a.extend(f.prototype,{refresh:function(){this.deselect(),this.visible=this.element.is(":visible")},show:function(){this.visible||(this.deselect(),this.element.show(),this.visible=!0)},hide:function(){this.element.hide(),this.visible=!1},select:function(a,b){var c,d,e,f;a.hasClass("unselectable")||a==this.selected||(this.deselect(),this.selected=a.addClass("selected"),c=a.outerHeight(),d=this.element.height(),e=a.position().top,f=this.element.scrollTop(),e<0?this.element.scrollTop(f+e):e+c>d&&this.element.scrollTop(f+e-d+c),this.element.trigger("river-select",[a,b,this]))},deselect:function(){this.selected&&this.selected.removeClass("selected"),this.selected=!1},prev:function(){if(this.visible){var a;this.selected&&(a=this.selected.prev("li"),a.length&&this.select(a))}},next:function(){if(this.visible){var b=this.selected?this.selected.next("li"):a("li:not(.unselectable):first",this.element);b.length&&this.select(b)}},ajax:function(a){var b=this,c=1==this.query.page?0:wpLink.minRiverAJAXDuration,d=wpLink.delayedCallback(function(c,d){b.process(c,d),a&&a(c,d)},c);this.query.ajax(d)},change:function(a){this.query&&this._search==a||(this._search=a,this.query=new g(a),this.element.scrollTop(0))},process:function(c,d){var e="",f=!0,g="",h=1==d.page;c?a.each(c,function(){g=f?"alternate":"",g+=this.title?"":" no-title",e+=g?'<li class="'+g+'">':"<li>",e+='<input type="hidden" class="item-permalink" value="'+this.permalink+'" />',e+='<span class="item-title">',e+=this.title?this.title:b.noTitle,e+='</span><span class="item-info">'+this.info+"</span></li>",f=!f}):h&&(e+='<li class="unselectable no-matches-found"><span class="item-title"><em>'+b.noMatchesFound+"</em></span></li>"),this.ul[h?"html":"append"](e)},maybeLoad:function(){var a=this,b=this.element,c=b.scrollTop()+b.height();!this.query.ready()||c<this.contentHeight.height()-wpLink.riverBottomThreshold||setTimeout(function(){var c=b.scrollTop(),d=c+b.height();!a.query.ready()||d<a.contentHeight.height()-wpLink.riverBottomThreshold||(a.waiting.addClass("is-active"),b.scrollTop(c+a.waiting.outerHeight()),a.ajax(function(){a.waiting.removeClass("is-active")}))},wpLink.timeToTriggerRiver)}}),g=function(a){this.page=1,this.allLoaded=!1,this.querying=!1,this.search=a},a.extend(g.prototype,{ready:function(){return!(this.querying||this.allLoaded)},ajax:function(b){var c=this,d={action:"wp-link-ajax",page:this.page,_ajax_linking_nonce:k.nonce.val()};this.search&&(d.search=this.search),this.querying=!0,a.post(window.ajaxurl,d,function(a){c.page++,c.querying=!1,c.allLoaded=!a,b(a,d)},"json")}}),a(document).ready(wpLink.init)}(jQuery,window.wpLinkL10n,window.wp);